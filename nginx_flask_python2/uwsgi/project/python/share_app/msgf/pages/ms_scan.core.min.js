function msscan_res_view(t,e){var r=this;return this.doms={body:t},this.args={view_json:[{name:"h3",child:["Statistic"]},{name:"p",html:'Find <span class="pep_num"></span> peptide segments from the spectrums associated with <span class="prot_num"></span> proteins in database'},{name:"div",attr:{"class":"table_view"}}]},e&&Object.keys(e).map(function(t){r.args[t]=e[t]}),this.data={},this.mods={},this.init(),this}function mytable(t,e){return this.args=$.extend({col_hide:{},col_revise:{},th_revise:null,th_sort:!0,tr_render:function(t){return"<tr>"+t.reduce(function(t,e){return t.concat(["<td>"+e+"</td>"])},[]).join("")+"</tr>"},tr_click:!1},e),this.jq={body:$(t).addClass("mytable")},this.events=[],this}function my_ajax(){}msscan_res_view.prototype.init=function(){var t=this;this.doms.body.append_by_array(this.args.view_json);var e={pep_num:"span.pep_num",prot_num:"span.prot_num",res_table:"div.table_view"};Object.keys(e).map(function(r){t.doms[r]=t.doms.body.querySelector(e[r])})},msscan_res_view.prototype.ms_enrich=function(t){var e,r={};return Object.keys(t.prot2pep_ranges).map(function(n){e=t.prot2pep_ranges[n].transpose().slice(1,3).transpose(),r[n]=e.range_merge()}),t.prot2pep_cover=r,t},msscan_res_view.prototype.ms_oview_data=function(t){var e,r={colnames:["Protein","Peptide","AA number","coverage%"]};return r.data=Object.keys(t.prot2pep_ranges).map(function(r){return e=t.prot2pep_cover[r].map(function(t){return t[1]-t[0]}).sum(),[r,t.prot2pep_ranges[r].length,e,Math.round(100*e/t.prot2len[r])]}),r},msscan_res_view.prototype.render=function(t){this.data.ms_json=this.ms_enrich(t),this.doms.pep_num.innerHTML=Object.keys(t.pep2scan_scores).length,this.doms.prot_num.innerHTML=Object.keys(t.prot2len).length,this.mods.ms_table=new mytable(this.doms.res_table),this.mods.ms_table.render(this.ms_oview_data(this.data.ms_json))},mytable.prototype.event_prepare=function(){var t=this;this.args.tr_click&&this.events.push(["click","tbody>tr",function(e){t.row_selected_handler(e)}]),this.args.th_sort&&this.events.push(["click","thead>tr>th>div.th-inner",function(e){t.th_sort_handler(e)}]);for(var e=0;e<this.events.length;e++)this.jq.table.on(this.events[e][0],this.events[e][1],this.events[e][2])},mytable.prototype.jq_prepare=function(){this.jq.body.append('<div class="mytable_thead"></div><div class="mytable_inner"><table></table></div>'),this.jq.table=this.jq.body.find("table"),this.jq.thead=$("<thead>").appendTo(this.jq.table),this.jq.tbody=$("<tbody>").appendTo(this.jq.table),this.event_prepare()},mytable.prototype.thead_ren=function(){var t=this,e=this.data.colnames.reduce(function(e,r,n){return e.concat(t.args.col_hide[n]?[]:[r])},[]);this.args.th_revise&&(e=this.args.th_revise(ahead)),this.jq.thead.append("<tr>"+e.reduce(function(t,e){return t.concat(['<th><div class="th-inner">'+e+"</div></th>"])},[]).join("")+"</tr>")},mytable.prototype.thead_align=function(){var t=this.jq.thead.find("th"),e=t.find("div.th-inner"),r=e.map(function(){return $(this).width()+20});t.each(function(t){var e=$(this).width();r[t]>e&&$(this).width(r[t])});var n=t.map(function(){return $(this).width()});e.each(function(t){$(this).width(n[t])})},mytable.prototype.append_rows=function(t){for(var e=this,r=t.transpose(),n=[],a=0;a<r.length;a++)if(!this.args.col_hide[a]){var s=this.args.col_revise[a];n.push(s?r[a].reduce(function(e,r,n){return e.concat([s(r,t[n])])},[]):r[a])}return n.transpose().reduce(function(r,n,a){e.jq.table.append($(e.args.tr_render(n)).data({ind:a,row:t[a]}))},[]),this.thead_align(),this},mytable.prototype.render=function(t){return this.data=t,this.jq.body.empty(),this.jq_prepare(),this.thead_ren(),this.append_rows(this.data.data),this},mytable.prototype.tr_sort=function(t){var e=this,r=this.jq.tbody.find("tr");t.fn?r.sort(function(e,r){return t.fn($(e).data())>t.fn($(r).data())==t.reverse?1:-1}):null!=t.col_ind&&r.sort(function(e,r){return $(e).data("row")[t.col_ind]>$(r).data("row")[t.col_ind]==t.reverse?1:-1}),r.map(function(){e.jq.table.append($(this))})},mytable.prototype.th_sort_handler=function(t){var e=$(t.currentTarget),r=this.jq.thead.find("th").index(e.parent()),n=e.hasClass("up");!n==e.hasClass("down")&&e.toggleClass("down"),e.toggleClass("up"),this.jq.thead.find("th>div.th-inner").map(function(){this!=t.currentTarget&&$(this).removeClass("up down")}),this.tr_sort({col_ind:r,reverse:n})},mytable.prototype.row_selected_handler=function(t){for(var e=($(t.currentTarget).toggleClass("selected"),this.jq.tbody.find("tr.selected")),r=[],n=0;n<e.length;n++)r.push($(e[n]).data("row"));this.row_sel_call(r)},mytable.prototype.row_sel_call=function(t){console.log(t)},Array.prototype.transpose=function(){var t=this;return t[0].map(function(e,r){return t.map(function(t){return t[r]})})};var test=function(){};Array.prototype.to_matrix=function(){var t=this.slice(1).transpose();return{colnames:this[0].slice(1),rownames:t[0],data:t.slice(1).map(function(t){return t.map(function(t){return Number(t)})}).transpose()}},Array.prototype.scale_norm=function(t,e){var r=this,n=Math.min.apply(this,e||r),a=Math.max.apply(this,e||r),s=(a-n)/t;return r.reduce(function(t,e){return t.concat(Math.round((e-n)/s))},[])},Array.prototype.diff=function(){for(var t=this,e=a2=null,r=0;r<arguments.length;){e=[],a2=arguments[r];for(var n=t.length,a=a2.length,s=!0,o=0;n>o;o++){for(var i=0;a>i;i++)if(t[o]===a2[i]){s=!1;break}s?e.push(t[o]):s=!0}t=e,r++}return e.unique()},Array.prototype.intersect=function(){if(!arguments.length)return[];for(var t=this,e=a2=null,r=0;r<arguments.length;){e=[],a2=arguments[r];for(var n=t.length,a=a2.length,s=0;n>s;s++)for(var o=0;a>o;o++)t[s]===a2[o]&&e.push(t[s]);t=e,r++}return e.unique()},Array.prototype.unique=function(){for(var t=[],e=this.length,r=0;e>r;r++){for(var n=r+1;e>n;n++)this[r]===this[n]&&(n=++r);t.push(this[r])}return t},Array.prototype.rep_ind=function(){return this.reduce(function(t,e,r){return isNaN(e)||(t[e]||(t[e]=[]),t[e].push(r)),t},{})},Array.prototype.cumulate=function(){return this.reduce(function(t,e,r){return t.concat(r&&[t[r-1]+e]||[e])},[])},Array.prototype.to_table=function(t){var e=t&&"#"+t.join("	")+"\n"||"";return e+this.reduce(function(t,e){return t.concat(e.join("	"))},[]).join("\n")},Array.prototype.html_table=function(t){var e=t?"<thead><tr><th>"+t.join("</th><th>")+"</th></tr></thead>":"";return"<table>"+e+"<tbody>"+this.reduce(function(t,e){return t.concat("<tr><td>"+e.join("</td><td>")+"</td></tr>")},[]).join("")+"</tbody></table>"},Array.prototype.transpose=function(){var t=this,e=t.map(function(t){return t.length}).sort();return e[0]<e[e.length-1]&&console.log("arrays dimesion are not equal when transpose"),t[0].slice(0,e[0]).map(function(e,r){return t.map(function(t){return t[r]})})},Array.prototype.toggle=function(t){var e=this.indexOf(t);return-1==e?this.push(t):this.splice(e,1),this},Array.prototype.list2dict=function(t,e){for(var r={},n=0;n<this.length;n++)t in this[n]&&e in this[n]&&(r[this[n][t]]=this[n][e]);return r},Array.prototype.array_map=function(t){return this.map(function(e){return Object.keys(t).reduce(function(r,n){return r[t[n]]=e[n],r},{})})},Array.prototype.range=function(t){var e=t||this.length;return Array.apply(null,Array(e)).map(function(t,e){return e})},Array.prototype.equals=function(t){if(!t)return!1;if(this.length!=t.length)return!1;for(var e=0,r=this.length;r>e;e++)if(this[e]instanceof Array&&t[e]instanceof Array){if(!this[e].equals(t[e]))return!1}else if(this[e]!=t[e])return!1;return!0},Array.prototype.sum=function(){return this.reduce(function(t,e){return t+e})},Array.prototype.rep_num=function(){return this.reduce(function(t,e){return isNaN(e)||(t[e]||(t[e]=0),t[e]++),t},{})},Array.prototype.range_merge=function(){this.sort(function(t,e){return t[0]>e[0]});for(var t,e=0,r=this.slice(0,1),n=1;n<this.length;n++)t=this[n].reduce(function(t,n){return t+(n<=r[e][1])},0),1==t?r[e]=[r[e][0],this[n][1]]:0==t&&(r.push(this[n]),e++);return r},Array.prototype.sum=function(){return this.reduce(function(t,e){return t+e})},Array.prototype.mean=function(){return this.sum()/this.length},Array.prototype.ss=function(){var t=this.mean();return this.map(function(e){return Math.pow(e-t,2)}).sum()},Array.prototype.sd=function(){return Math.pow(this.ss()/this.length,.5)},Array.prototype.cv=function(){return this.sd()/this.mean()},Array.prototype.z_scores=function(){var t=this.mean(),e=this.sd();return e?this.map(function(r){return(r-t)/e}):Array.apply(null,new Array(this.length)).map(function(){return 0})},HTMLElement.prototype.append_by_array=function(t){var e=this;return t.map(function(t){var r;"string"==typeof t?r=document.createTextNode(t):(r=document.createElement(t.name),t.attr&&Object.keys(t.attr).map(function(e){r.setAttribute(e,t.attr[e])}),t.child&&t.child.hasOwnProperty("length")?r.append_by_array(t.child):t.html&&(r.innerHTML=t.html)),e.appendChild(r)}),this},my_ajax.prototype.ajaxcore=function(t,e){var r=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return r.open(t.method,t.url),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.onreadystatechange=function(){r.readyState>3&&200==r.status&&(e.success?e.success(r.responseText):console.log("set success function for xhr.responseText"))},r},my_ajax.prototype.get_ajax=function(t,e){var r=this.ajaxcore({url:t,method:"GET"},e);return r.send(),r},my_ajax.prototype.post_ajax=function(t,e,r){var n=this.ajaxcore({url:t,method:"POST"},r),a="string"==typeof e?e:Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&");return n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(a),n};var test=function(){};FileReader.prototype.file_dom_setup=function(t){function e(t){t.preventDefault(),t.dataTransfer.dropEffect="copy"}function r(t){t.preventDefault(),a.readAsText(t.dataTransfer.files[0],"UTF-8")}function n(t){a.readAsText(t.target.files[0],"UTF-8")}var a=this;return t.addEventListener("dragover",e,!1),t.addEventListener("drop",r,!1),t.addEventListener("change",n,!1),a};